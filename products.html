<!DOCTYPE html>
<html lang="lv">
<head>
  <meta charset="UTF-8">
  <title>Veikals | LaptopHub</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:400,600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/base/variables.css">
  <link rel="stylesheet" href="css/base/reset.css">
  <link rel="stylesheet" href="css/layout/navigation.css">
  <link rel="stylesheet" href="css/layout/footer.css">
  <link rel="stylesheet" href="css/components/buttons.css">
  <link rel="stylesheet" href="css/components/forms.css">
  <link rel="stylesheet" href="css/components/cards.css">
  <link rel="stylesheet" href="css/pages/products.css">
</head>
<body>
  <!-- Navigation -->
  <nav>
    <div class="nav-container">
      <a href="index.html" class="logo">ğŸ’¼ LaptopHub</a>
      <ul class="nav-menu">
        <li><a href="index.html">SÄkums</a></li>
        <li><a href="products.html">Veikals</a></li>
        <li><a href="about.html">Par Mums</a></li>
        <li><a href="contact.html">Kontakti</a></li>
        <li><a href="gallery.html">Galerija</a></li>
        <li><a href="login.html" class="admin-link">Admin</a></li>
      </ul>
    </div>
  </nav>

  <!-- Page Header -->
  <div class="page-header">
    <div class="page-title">MÅ«su KlÄ“pjdatoru Kolekcija</div>
    <div class="page-subtitle">Atrodiet ideÄlo biznesa klÄ“pjdatoru jÅ«su vajadzÄ«bÄm</div>
  </div>

  <!-- Filters -->
  <div class="filters">
    <span class="filter-label">FiltrÄ“t pÄ“c:</span>
    <select class="filter-select" id="brandFilter">
      <option value="all">Visi ZÄ«moli</option>
      <option value="Lenovo ThinkPad">Lenovo ThinkPad</option>
      <option value="Dell Latitude">Dell Latitude</option>
      <option value="HP EliteBook">HP EliteBook</option>
    </select>
    <select class="filter-select" id="conditionFilter">
      <option value="all">Visi StÄvokÄ¼i</option>
      <option value="excellent">Izcils</option>
      <option value="very-good">Ä»oti Labs</option>
      <option value="good">Labs</option>
    </select>
    <select class="filter-select" id="sortFilter">
      <option value="price-low">Cena: ZemÄkÄ - AugstÄkÄ</option>
      <option value="price-high">Cena: AugstÄkÄ - ZemÄkÄ</option>
      <option value="brand">PÄ“c ZÄ«mola</option>
    </select>
  </div>

  <!-- Products Grid -->
  <div class="products-container">
    <div class="products-grid" id="productsGrid">
      <!-- Products will be loaded here by JavaScript -->
    </div>
  </div>

  <!-- Footer -->
  <footer>
    <div class="footer-links">
      <a href="index.html">SÄkums</a>
      <a href="products.html">Veikals</a>
      <a href="about.html">Par Mums</a>
      <a href="contact.html">Kontakti</a>
    </div>
    <p>&copy; 2024 LaptopHub. Visas tiesÄ«bas aizsargÄtas.</p>
  </footer>

  <script>
    let laptops = [];
    let filteredLaptops = [];

    // Fetch laptops from API
    async function fetchLaptops() {
      try {
        const response = await fetch('/api/laptops.php');
        const result = await response.json();

        if (result.success) {
          laptops = result.laptops;
          applyFilters();
        } else {
          console.error('Failed to fetch laptops:', result.error);
        }
      } catch (error) {
        console.error('Error fetching laptops:', error);
      }
    }

    // Condition labels in Latvian
    const conditionLabels = {
      'excellent': 'Izcils',
      'very-good': 'Ä»oti Labs',
      'good': 'Labs'
    };

    function renderProducts() {
      const grid = document.getElementById('productsGrid');

      if (filteredLaptops.length === 0) {
        grid.innerHTML = '<div class="no-products">Nav atrasti produkti pÄ“c izvÄ“lÄ“tajiem filtriem.</div>';
        return;
      }

      grid.innerHTML = filteredLaptops.map((laptop, index) => {
        const displayImage = (laptop.images && laptop.images.length > 0) ? laptop.images[0] : laptop.imageUrl;
        return `
        <div class="product-card" onclick="viewLaptop(${laptops.indexOf(laptop)})">
          <img class="product-img" src="${displayImage}" alt="${laptop.brand} ${laptop.model}">
          <div class="product-info">
            <div class="product-brand">${laptop.brand}</div>
            <div class="product-model">${laptop.model}</div>
            <div class="condition-badge condition-${laptop.condition}">${conditionLabels[laptop.condition] || laptop.condition}</div>
            <div class="product-specs">
              ${laptop.processor}<br>
              ${laptop.ram} â€¢ ${laptop.storage}<br>
              ${laptop.screen}
            </div>
            <div class="product-price">$${laptop.price}</div>
            <button class="view-btn">ApskatÄ«t DetaÄ¼as</button>
          </div>
        </div>
      `;
      }).join('');
    }

    function viewLaptop(id) {
      window.location.href = `laptop-detail.html?id=${id}`;
    }

    function applyFilters() {
      const brandFilter = document.getElementById('brandFilter').value;
      const conditionFilter = document.getElementById('conditionFilter').value;
      const sortFilter = document.getElementById('sortFilter').value;

      // Apply filters
      filteredLaptops = laptops.filter(laptop => {
        const brandMatch = brandFilter === 'all' || laptop.brand === brandFilter;
        const conditionMatch = conditionFilter === 'all' || laptop.condition === conditionFilter;
        return brandMatch && conditionMatch;
      });

      // Apply sorting
      if (sortFilter === 'price-low') {
        filteredLaptops.sort((a, b) => a.price - b.price);
      } else if (sortFilter === 'price-high') {
        filteredLaptops.sort((a, b) => b.price - a.price);
      } else if (sortFilter === 'brand') {
        filteredLaptops.sort((a, b) => a.brand.localeCompare(b.brand));
      }

      renderProducts();
    }

    // Event listeners for filters
    document.getElementById('brandFilter').addEventListener('change', applyFilters);
    document.getElementById('conditionFilter').addEventListener('change', applyFilters);
    document.getElementById('sortFilter').addEventListener('change', applyFilters);

    // Initial render
    fetchLaptops();

    // Reload laptops when page becomes visible
    document.addEventListener('visibilitychange', function() {
      if (!document.hidden) {
        fetchLaptops();
      }
    });
  </script>
</body>
</html>
