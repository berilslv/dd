<!DOCTYPE html>
<html lang="lv">
<head>
  <meta charset="UTF-8">
  <title>AttÄ“lu Galerija | LaptopHub</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:400,600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/base/variables.css">
  <link rel="stylesheet" href="css/base/reset.css">
  <link rel="stylesheet" href="css/layout/navigation.css">
  <link rel="stylesheet" href="css/pages/gallery.css">
</head>
<body>
  <!-- Navigation -->
  <nav>
    <div class="nav-container">
      <a href="index.html" class="logo">ğŸ’¼ LaptopHub</a>
      <ul class="nav-menu">
        <li><a href="index.html">SÄkums</a></li>
        <li><a href="products.html">Veikals</a></li>
        <li><a href="about.html">Par Mums</a></li>
        <li><a href="contact.html">Kontakti</a></li>
        <li><a href="gallery.html">Galerija</a></li>
      </ul>
    </div>
  </nav>

  <!-- Main Content -->
  <div class="container">
    <h1 class="page-title">AttÄ“lu Galerija</h1>

    <!-- Upload Section -->
    <div class="upload-section">
      <div class="upload-area" id="uploadArea">
        <div class="upload-icon">ğŸ“¸</div>
        <div class="upload-text">NoklikÅ¡Ä·iniet vai ievelciet attÄ“lus Å¡eit</div>
        <div class="upload-hint">Atbalsta: JPG, PNG, GIF (vairÄkus attÄ“lus)</div>
      </div>
      <input type="file" id="fileInput" multiple accept="image/*">

      <!-- Imgur Link Input -->
      <div class="imgur-input-container">
        <label class="imgur-label">Vai ielÄ«mÄ“jiet Imgur saiti:</label>
        <div class="imgur-input-group">
          <input type="text" id="imgurInput" class="imgur-input" placeholder="https://imgur.com/a/... vai https://imgur.com/gallery/...">
          <button class="imgur-btn" onclick="loadImgurImages()">IelÄdÄ“t</button>
        </div>
      </div>

      <!-- Thumbnails -->
      <div class="thumbnails" id="thumbnails"></div>
    </div>

    <!-- Viewer Section -->
    <div class="viewer-section">
      <div class="viewer-container" id="viewerContainer">
        <div class="empty-viewer" id="emptyViewer">
          Nav atlasÄ«tu attÄ“lu<br>
          <small>AugÅ¡upielÄdÄ“jiet vai ielÄ«mÄ“jiet Imgur saiti</small>
        </div>
        <img id="viewerImage" class="viewer-image" style="display: none;" alt="SkatÄ«t attÄ“lu">
      </div>

      <!-- Controls -->
      <div class="controls">
        <button class="control-btn nav-btn" onclick="prevImage()" id="prevBtn" disabled>â€¹</button>
        <div class="image-counter" id="imageCounter">0 / 0</div>
        <button class="control-btn nav-btn" onclick="nextImage()" id="nextBtn" disabled>â€º</button>

        <button class="control-btn" onclick="zoomOut()">ğŸ”âˆ’</button>
        <div class="zoom-indicator" id="zoomIndicator">100%</div>
        <button class="control-btn" onclick="zoomIn()">ğŸ”+</button>

        <button class="control-btn" onclick="resetZoom()">AtiestatÄ«t</button>
        <button class="control-btn" onclick="clearGallery()">NotÄ«rÄ«t</button>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <footer>
    <p>&copy; 2024 LaptopHub. Visas tiesÄ«bas aizsargÄtas.</p>
  </footer>

  <script>
    // Gallery state
    let images = [];
    let currentIndex = 0;
    let zoomLevel = 1;
    let isDragging = false;
    let startX = 0;
    let startY = 0;
    let translateX = 0;
    let translateY = 0;

    // Elements
    const uploadArea = document.getElementById('uploadArea');
    const fileInput = document.getElementById('fileInput');
    const thumbnails = document.getElementById('thumbnails');
    const viewerContainer = document.getElementById('viewerContainer');
    const viewerImage = document.getElementById('viewerImage');
    const emptyViewer = document.getElementById('emptyViewer');
    const imageCounter = document.getElementById('imageCounter');
    const zoomIndicator = document.getElementById('zoomIndicator');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');

    // Upload Area Click
    uploadArea.addEventListener('click', () => {
      fileInput.click();
    });

    // File Input Change
    fileInput.addEventListener('change', (e) => {
      handleFiles(e.target.files);
    });

    // Drag and Drop
    uploadArea.addEventListener('dragover', (e) => {
      e.preventDefault();
      uploadArea.classList.add('dragover');
    });

    uploadArea.addEventListener('dragleave', () => {
      uploadArea.classList.remove('dragover');
    });

    uploadArea.addEventListener('drop', (e) => {
      e.preventDefault();
      uploadArea.classList.remove('dragover');
      handleFiles(e.dataTransfer.files);
    });

    // Handle Files
    function handleFiles(files) {
      const fileArray = Array.from(files);
      const imageFiles = fileArray.filter(file => file.type.startsWith('image/'));

      imageFiles.forEach(file => {
        const reader = new FileReader();
        reader.onload = (e) => {
          images.push(e.target.result);
          updateThumbnails();
          if (images.length === 1) {
            currentIndex = 0;
            displayImage();
          }
        };
        reader.readAsDataURL(file);
      });
    }

    // Update Thumbnails
    function updateThumbnails() {
      thumbnails.innerHTML = '';
      images.forEach((src, index) => {
        const img = document.createElement('img');
        img.src = src;
        img.className = 'thumbnail';
        if (index === currentIndex) {
          img.classList.add('active');
        }
        img.onclick = () => {
          currentIndex = index;
          displayImage();
        };
        thumbnails.appendChild(img);
      });
      updateCounter();
      updateNavigationButtons();
    }

    // Display Image
    function displayImage() {
      if (images.length === 0) {
        viewerImage.style.display = 'none';
        emptyViewer.style.display = 'block';
        return;
      }

      emptyViewer.style.display = 'none';
      viewerImage.style.display = 'block';
      viewerImage.src = images[currentIndex];

      // Reset transformations
      zoomLevel = 1;
      translateX = 0;
      translateY = 0;
      updateTransform();
      updateZoomIndicator();
      updateThumbnails();
    }

    // Navigation
    function prevImage() {
      if (currentIndex > 0) {
        currentIndex--;
        displayImage();
      }
    }

    function nextImage() {
      if (currentIndex < images.length - 1) {
        currentIndex++;
        displayImage();
      }
    }

    function updateNavigationButtons() {
      prevBtn.disabled = currentIndex === 0 || images.length === 0;
      nextBtn.disabled = currentIndex === images.length - 1 || images.length === 0;
    }

    // Keyboard Navigation
    document.addEventListener('keydown', (e) => {
      if (images.length === 0) return;

      if (e.key === 'ArrowLeft') prevImage();
      if (e.key === 'ArrowRight') nextImage();
      if (e.key === '+' || e.key === '=') zoomIn();
      if (e.key === '-' || e.key === '_') zoomOut();
      if (e.key === '0') resetZoom();
    });

    // Zoom Functions
    function zoomIn() {
      if (images.length === 0) return;
      zoomLevel = Math.min(zoomLevel + 0.25, 5);
      updateTransform();
      updateZoomIndicator();
    }

    function zoomOut() {
      if (images.length === 0) return;
      zoomLevel = Math.max(zoomLevel - 0.25, 0.25);
      updateTransform();
      updateZoomIndicator();
    }

    function resetZoom() {
      if (images.length === 0) return;
      zoomLevel = 1;
      translateX = 0;
      translateY = 0;
      updateTransform();
      updateZoomIndicator();
    }

    // Mouse Wheel Zoom
    viewerContainer.addEventListener('wheel', (e) => {
      if (images.length === 0) return;
      e.preventDefault();

      if (e.deltaY < 0) {
        zoomLevel = Math.min(zoomLevel + 0.1, 5);
      } else {
        zoomLevel = Math.max(zoomLevel - 0.1, 0.25);
      }

      updateTransform();
      updateZoomIndicator();
    });

    // Drag to Pan
    viewerImage.addEventListener('mousedown', (e) => {
      if (images.length === 0) return;
      isDragging = true;
      startX = e.clientX - translateX;
      startY = e.clientY - translateY;
      viewerContainer.style.cursor = 'grabbing';
    });

    document.addEventListener('mousemove', (e) => {
      if (!isDragging) return;
      translateX = e.clientX - startX;
      translateY = e.clientY - startY;
      updateTransform();
    });

    document.addEventListener('mouseup', () => {
      isDragging = false;
      viewerContainer.style.cursor = 'move';
    });

    // Touch Support for Mobile
    let touchStartX = 0;
    let touchStartY = 0;
    let lastTouchDistance = 0;

    viewerImage.addEventListener('touchstart', (e) => {
      if (images.length === 0) return;

      if (e.touches.length === 1) {
        isDragging = true;
        touchStartX = e.touches[0].clientX - translateX;
        touchStartY = e.touches[0].clientY - translateY;
      } else if (e.touches.length === 2) {
        isDragging = false;
        const distance = Math.hypot(
          e.touches[0].clientX - e.touches[1].clientX,
          e.touches[0].clientY - e.touches[1].clientY
        );
        lastTouchDistance = distance;
      }
    });

    viewerImage.addEventListener('touchmove', (e) => {
      if (images.length === 0) return;
      e.preventDefault();

      if (e.touches.length === 1 && isDragging) {
        translateX = e.touches[0].clientX - touchStartX;
        translateY = e.touches[0].clientY - touchStartY;
        updateTransform();
      } else if (e.touches.length === 2) {
        const distance = Math.hypot(
          e.touches[0].clientX - e.touches[1].clientX,
          e.touches[0].clientY - e.touches[1].clientY
        );

        if (lastTouchDistance > 0) {
          const delta = distance - lastTouchDistance;
          zoomLevel = Math.max(0.25, Math.min(5, zoomLevel + delta * 0.01));
          updateTransform();
          updateZoomIndicator();
        }

        lastTouchDistance = distance;
      }
    });

    viewerImage.addEventListener('touchend', () => {
      isDragging = false;
      lastTouchDistance = 0;
    });

    // Update Transform
    function updateTransform() {
      viewerImage.style.transform = `translate(${translateX}px, ${translateY}px) scale(${zoomLevel})`;
    }

    // Update Zoom Indicator
    function updateZoomIndicator() {
      zoomIndicator.textContent = `${Math.round(zoomLevel * 100)}%`;
    }

    // Update Counter
    function updateCounter() {
      imageCounter.textContent = images.length > 0 ? `${currentIndex + 1} / ${images.length}` : '0 / 0';
    }

    // Clear Gallery
    function clearGallery() {
      if (confirm('Vai tieÅ¡Äm vÄ“laties notÄ«rÄ«t visus attÄ“lus?')) {
        images = [];
        currentIndex = 0;
        thumbnails.innerHTML = '';
        displayImage();
        updateCounter();
        updateNavigationButtons();
      }
    }

    // Imgur Integration
    async function loadImgurImages() {
      const input = document.getElementById('imgurInput');
      const url = input.value.trim();

      if (!url) {
        alert('LÅ«dzu, ievadiet Imgur saiti');
        return;
      }

      try {
        // Extract album/gallery ID from URL
        let albumId = '';

        // Handle different Imgur URL formats
        if (url.includes('/a/')) {
          albumId = url.split('/a/')[1].split(/[/?]/)[0];
        } else if (url.includes('/gallery/')) {
          albumId = url.split('/gallery/')[1].split(/[/?]/)[0];
        } else if (url.includes('imgur.com/')) {
          // Single image
          const imageId = url.split('imgur.com/')[1].split(/[./?]/)[0];
          const imageUrl = `https://i.imgur.com/${imageId}.jpg`;
          images.push(imageUrl);
          if (images.length === 1) {
            currentIndex = 0;
          }
          updateThumbnails();
          displayImage();
          input.value = '';
          return;
        }

        if (!albumId) {
          alert('NederÄ«ga Imgur saite. LÅ«dzu, izmantojiet formÄtu: https://imgur.com/a/... vai https://imgur.com/gallery/...');
          return;
        }

        // For demonstration, we'll show a message about Imgur API
        // In production, you would need to use Imgur API with client ID
        alert('Imgur albums prasa API atslÄ“gu. Å obrÄ«d varat augÅ¡upielÄdÄ“t attÄ“lus tieÅ¡i vai izmantot atseviÅ¡Ä·u Imgur attÄ“la saiti (piemÄ“ram: https://imgur.com/abc123)');

      } catch (error) {
        alert('KÄ¼Å«da ielÄdÄ“jot no Imgur: ' + error.message);
      }
    }

    // Initialize
    updateCounter();
    updateNavigationButtons();
    updateZoomIndicator();
  </script>
</body>
</html>
