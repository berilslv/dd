<!DOCTYPE html>
<html lang="lv">
<head>
  <meta charset="UTF-8">
  <title>Laptop Details | LaptopHub</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:400,600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/base/variables.css">
  <link rel="stylesheet" href="css/base/reset.css">
  <link rel="stylesheet" href="css/layout/navigation.css">
  <link rel="stylesheet" href="css/layout/footer.css">
  <link rel="stylesheet" href="css/components/buttons.css">
  <link rel="stylesheet" href="css/components/cards.css">
  <link rel="stylesheet" href="css/pages/laptop-detail.css">
</head>
<body>
  <!-- Navigation -->
  <nav>
    <div class="nav-container">
      <a href="index.html" class="logo">ğŸ’¼ LaptopHub</a>
      <ul class="nav-menu">
        <li><a href="index.html">SÄkums</a></li>
        <li><a href="products.html">Veikals</a></li>
        <li><a href="about.html">Par Mums</a></li>
        <li><a href="contact.html">Kontakti</a></li>
        <li><a href="gallery.html">Galerija</a></li>
        <li><a href="login.html" class="admin-link">Admin</a></li>
      </ul>
    </div>
  </nav>

  <!-- Detail Container -->
  <div class="detail-container">
    <a href="products.html" class="back-btn">â† AtpakaÄ¼ uz Veikalu</a>

    <div id="laptopDetail">
      <!-- Content will be loaded by JavaScript -->
    </div>
  </div>

  <!-- Footer -->
  <footer>
    <div class="footer-links">
      <a href="index.html">SÄkums</a>
      <a href="products.html">Veikals</a>
      <a href="about.html">Par Mums</a>
      <a href="contact.html">Kontakti</a>
    </div>
    <p>&copy; 2024 LaptopHub. Visas tiesÄ«bas aizsargÄtas.</p>
  </footer>

  <script>
    // Gallery state
    let currentImageIndex = 0;
    let zoomLevel = 1;
    let isDragging = false;
    let startX = 0;
    let startY = 0;
    let translateX = 0;
    let translateY = 0;
    let currentLaptop = null;

    // Condition labels in Latvian
    const conditionLabels = {
      'excellent': 'Izcils StÄvoklis',
      'very-good': 'Ä»oti Labs StÄvoklis',
      'good': 'Labs StÄvoklis'
    };

    // Load laptop details
    async function loadLaptopDetails() {
      const urlParams = new URLSearchParams(window.location.search);
      const laptopId = parseInt(urlParams.get('id'));

      const container = document.getElementById('laptopDetail');

      try {
        const response = await fetch('/api/laptops.php');
        const result = await response.json();

        if (!result.success) {
          throw new Error(result.error || 'Failed to fetch laptops');
        }

        const laptops = result.laptops;
        const laptop = laptops[laptopId];


        if (!laptop) {
          container.innerHTML = `
            <div class="error-message">
              <h2>KlÄ“pjdators nav atrasts</h2>
              <p>DiemÅ¾Ä“l Å¡is produkts vairs nav pieejams.</p>
              <a href="products.html" class="buy-btn" style="display: inline-block; margin-top: 20px;">Atgriezties uz Veikalu</a>
            </div>
          `;
          return;
        }

      currentLaptop = laptop;
      const images = laptop.images || [laptop.imageUrl];
      const visualRating = laptop.visualRating || 0;
      const technicalRating = laptop.technicalRating || 0;

      // Generate stars for ratings
      const getStars = (rating) => {
        const fullStars = Math.floor(rating);
        const halfStar = rating % 1 >= 0.5 ? 1 : 0;
        const emptyStars = 10 - fullStars - halfStar;
        return 'â˜…'.repeat(fullStars) + (halfStar ? 'Â½' : '') + 'â˜†'.repeat(emptyStars);
      };

      const thumbnailsHTML = images.length > 1 ? `
        <div class="thumbnails" id="thumbnails">
          ${images.map((src, index) => `
            <img src="${src}" alt="Thumbnail ${index + 1}" class="thumbnail${index === 0 ? ' active' : ''}" onclick="selectImage(${index})">
          `).join('')}
        </div>
      ` : '';

      container.innerHTML = `
        <div class="detail-card">
          <div class="detail-grid">
            <div class="detail-image-section">
              <div class="image-gallery">
                <div class="main-image-container" id="imageContainer">
                  <img id="mainImage" class="main-image" src="${images[0]}" alt="${laptop.brand} ${laptop.model}">
                  ${images.length > 1 ? `
                    <button class="image-nav-btn prev" onclick="prevImage()" id="prevImageBtn">â€¹</button>
                    <button class="image-nav-btn next" onclick="nextImage()" id="nextImageBtn">â€º</button>
                    <div class="image-counter" id="imageCounter">1 / ${images.length}</div>
                  ` : ''}
                  <div class="zoom-controls">
                    <button class="zoom-btn" onclick="zoomOut()">âˆ’</button>
                    <div class="zoom-level" id="zoomLevel">100%</div>
                    <button class="zoom-btn" onclick="zoomIn()">+</button>
                    <button class="zoom-btn" onclick="resetZoom()" title="Reset">â†»</button>
                  </div>
                </div>
                ${thumbnailsHTML}
              </div>
              <span class="condition-badge condition-${laptop.condition}">${conditionLabels[laptop.condition] || laptop.condition}</span>
            </div>

            <div class="detail-info">
              <div class="detail-brand">${laptop.brand}</div>
              <h1 class="detail-model">${laptop.model}</h1>
              <div class="detail-price">$${laptop.price}</div>
              <p class="detail-description">${laptop.description}</p>

              ${visualRating > 0 || technicalRating > 0 ? `
                <div class="ratings-section">
                  <div class="rating-box">
                    <div class="rating-label">VizuÄlais StÄvoklis</div>
                    <div class="rating-score">${visualRating}<span>/10</span></div>
                    <div class="rating-stars">${getStars(visualRating)}</div>
                  </div>
                  <div class="rating-box">
                    <div class="rating-label">Tehniskais StÄvoklis</div>
                    <div class="rating-score">${technicalRating}<span>/10</span></div>
                    <div class="rating-stars">${getStars(technicalRating)}</div>
                  </div>
                </div>
              ` : ''}

              <div class="specs-section">
                <h3 class="specs-title">SpecifikÄcijas</h3>
                <div class="spec-item">
                  <span class="spec-label">Procesors:</span>
                  <span class="spec-value">${laptop.processor}</span>
                </div>
                <div class="spec-item">
                  <span class="spec-label">OperatÄ«vÄ AtmiÅ†a:</span>
                  <span class="spec-value">${laptop.ram}</span>
                </div>
                <div class="spec-item">
                  <span class="spec-label">AtmiÅ†a:</span>
                  <span class="spec-value">${laptop.storage}</span>
                </div>
                <div class="spec-item">
                  <span class="spec-label">EkrÄns:</span>
                  <span class="spec-value">${laptop.screen}</span>
                </div>
              </div>

              <div class="features-section">
                <h3 class="features-title">IekÄ¼auts KomplektÄ</h3>
                <ul class="features-list">
                  <li>1 Gada Garantija</li>
                  <li>Bezmaksas PiegÄde</li>
                  <li>ProfesionÄla PÄrbaude un TÄ«rÄ«Å¡ana</li>
                  <li>LicencÄ“ta Windows 10/11 Pro</li>
                  <li>LÄdÄ“tÄjs un Visi KabeÄ¼i</li>
                </ul>
              </div>

              <div class="action-buttons">
                <a href="contact.html" class="buy-btn">SazinÄties</a>
                <a href="products.html" class="contact-btn">Citi Produkti</a>
              </div>
            </div>
          </div>
        </div>
      `;

        // Initialize gallery controls
        initializeGallery();
      } catch (error) {
        console.error('Error loading laptop details:', error);
        container.innerHTML = `
          <div class="error-message">
            <h2>KÄ¼Å«da ielÄdÄ“jot datus</h2>
            <p>NeizdevÄs ielÄdÄ“t klÄ“pjdatora informÄciju. LÅ«dzu, mÄ“Ä£iniet vÄ“lreiz.</p>
            <a href="products.html" class="buy-btn" style="display: inline-block; margin-top: 20px;">Atgriezties uz Veikalu</a>
          </div>
        `;
      }
    }

    // Gallery Functions
    function initializeGallery() {
      const imageContainer = document.getElementById('imageContainer');
      const mainImage = document.getElementById('mainImage');

      if (!imageContainer || !mainImage) return;

      // Mouse wheel zoom
      imageContainer.addEventListener('wheel', (e) => {
        e.preventDefault();
        if (e.deltaY < 0) {
          zoomLevel = Math.min(zoomLevel + 0.1, 5);
        } else {
          zoomLevel = Math.max(zoomLevel - 0.1, 0.25);
        }
        updateTransform();
        updateZoomDisplay();
      });

      // Drag to pan
      mainImage.addEventListener('mousedown', (e) => {
        isDragging = true;
        startX = e.clientX - translateX;
        startY = e.clientY - translateY;
        imageContainer.style.cursor = 'grabbing';
      });

      document.addEventListener('mousemove', (e) => {
        if (!isDragging) return;
        translateX = e.clientX - startX;
        translateY = e.clientY - startY;
        updateTransform();
      });

      document.addEventListener('mouseup', () => {
        isDragging = false;
        if (imageContainer) imageContainer.style.cursor = 'move';
      });

      // Touch support
      let touchStartX = 0;
      let touchStartY = 0;
      let lastTouchDistance = 0;

      mainImage.addEventListener('touchstart', (e) => {
        if (e.touches.length === 1) {
          isDragging = true;
          touchStartX = e.touches[0].clientX - translateX;
          touchStartY = e.touches[0].clientY - translateY;
        } else if (e.touches.length === 2) {
          isDragging = false;
          const distance = Math.hypot(
            e.touches[0].clientX - e.touches[1].clientX,
            e.touches[0].clientY - e.touches[1].clientY
          );
          lastTouchDistance = distance;
        }
      });

      mainImage.addEventListener('touchmove', (e) => {
        e.preventDefault();
        if (e.touches.length === 1 && isDragging) {
          translateX = e.touches[0].clientX - touchStartX;
          translateY = e.touches[0].clientY - touchStartY;
          updateTransform();
        } else if (e.touches.length === 2) {
          const distance = Math.hypot(
            e.touches[0].clientX - e.touches[1].clientX,
            e.touches[0].clientY - e.touches[1].clientY
          );
          if (lastTouchDistance > 0) {
            const delta = distance - lastTouchDistance;
            zoomLevel = Math.max(0.25, Math.min(5, zoomLevel + delta * 0.01));
            updateTransform();
            updateZoomDisplay();
          }
          lastTouchDistance = distance;
        }
      });

      mainImage.addEventListener('touchend', () => {
        isDragging = false;
        lastTouchDistance = 0;
      });

      // Keyboard navigation
      document.addEventListener('keydown', (e) => {
        const images = currentLaptop?.images || [currentLaptop?.imageUrl];
        if (images.length <= 1) return;

        if (e.key === 'ArrowLeft') prevImage();
        if (e.key === 'ArrowRight') nextImage();
      });
    }

    function updateTransform() {
      const mainImage = document.getElementById('mainImage');
      if (mainImage) {
        mainImage.style.transform = `translate(${translateX}px, ${translateY}px) scale(${zoomLevel})`;
      }
    }

    function updateZoomDisplay() {
      const zoomLevelEl = document.getElementById('zoomLevel');
      if (zoomLevelEl) {
        zoomLevelEl.textContent = `${Math.round(zoomLevel * 100)}%`;
      }
    }

    function zoomIn() {
      zoomLevel = Math.min(zoomLevel + 0.25, 5);
      updateTransform();
      updateZoomDisplay();
    }

    function zoomOut() {
      zoomLevel = Math.max(zoomLevel - 0.25, 0.25);
      updateTransform();
      updateZoomDisplay();
    }

    function resetZoom() {
      zoomLevel = 1;
      translateX = 0;
      translateY = 0;
      updateTransform();
      updateZoomDisplay();
    }

    function selectImage(index) {
      const images = currentLaptop?.images || [currentLaptop?.imageUrl];
      currentImageIndex = index;
      const mainImage = document.getElementById('mainImage');
      if (mainImage) {
        mainImage.src = images[index];
      }

      // Reset zoom and pan
      resetZoom();

      // Update thumbnails
      const thumbnails = document.querySelectorAll('.thumbnail');
      thumbnails.forEach((thumb, i) => {
        thumb.classList.toggle('active', i === index);
      });

      // Update counter and buttons
      updateImageCounter();
      updateNavButtons();
    }

    function prevImage() {
      const images = currentLaptop?.images || [currentLaptop?.imageUrl];
      if (currentImageIndex > 0) {
        selectImage(currentImageIndex - 1);
      }
    }

    function nextImage() {
      const images = currentLaptop?.images || [currentLaptop?.imageUrl];
      if (currentImageIndex < images.length - 1) {
        selectImage(currentImageIndex + 1);
      }
    }

    function updateImageCounter() {
      const images = currentLaptop?.images || [currentLaptop?.imageUrl];
      const counter = document.getElementById('imageCounter');
      if (counter) {
        counter.textContent = `${currentImageIndex + 1} / ${images.length}`;
      }
    }

    function updateNavButtons() {
      const images = currentLaptop?.images || [currentLaptop?.imageUrl];
      const prevBtn = document.getElementById('prevImageBtn');
      const nextBtn = document.getElementById('nextImageBtn');

      if (prevBtn) prevBtn.disabled = currentImageIndex === 0;
      if (nextBtn) nextBtn.disabled = currentImageIndex === images.length - 1;
    }

    // Initialize
    loadLaptopDetails();
  </script>
</body>
</html>
